-*- org -*-

* DONE Apostrophe does not match                                        :BUG:
  CLOSED: [2026-01-06 Tue 17:56]
  Apostrophe should work the same as any letter. Meaning that the following
  should match, but it doesn't.
      ----------------------------------------
      zdb "bat'" klingon.zdb
      zdb "bat'leth" klingon.zdb
      ----------------------------------------
* DONE Search fails if all terms are negated                            :BUG:
  CLOSED: [2026-01-08 Thu 17:07]
  Should work (not result in error message).
      ----------------------------------------
      zdb -- -batlh klingon.zdb
      ----------------------------------------
* DONE Database is clobbered when adding fields                         :BUG:
  CLOSED: [2026-01-08 Thu 17:46]
  The following command, which matches multiple records, clobbers
  'klingon.zdb', overwriting it with a zero-byte file!!

      ----------------------------------------
      zdb 'batlh' hi=nono klingon.zdb
      ----------------------------------------
* DONE Query with missing start parentheses                             :BUG:
  CLOSED: [2026-01-13 Tue 22:39]
  A query "a)" should be perfectly valid.
* DONE Flatten unnecessary parentheses in query
  CLOSED: [2026-01-16 Fri 12:10]
  A search containing parentheses should be flattened if possible. That is, for
  (non-negated) parentheses with the SAME operator as its surroundings the
  parenthesis should be flattened (the parenthesis removed, but its content
  kept). While for negated parentheses with the OPPOSITE operator as its
  surroundings, the parenthesis should be flattened and the operator inside
  flipped, and each term inside negated.

  For example:
  ----------------------------------------
  + 'a  (b c)' -> 'a  b  c'
  + 'a -(b,c)' -> 'a -b -c'
  ----------------------------------------

  Parentheses not fulfill to the condition should be kept as-is.
  ----------------------------------------
  + 'a  (b,c)' -> 'a ( b, c)'
  + 'a -(b c)' -> 'a (-b -c)'
  ----------------------------------------
* DONE Argument starting with /-\W/ should be taken for QUERY
  CLOSED: [2026-01-24 Sat 04:03]
  Instead of giving an 'Unknown option' error.
  -------------------------------------------------
  $ zdb '-(hej'
  zdb: Unknown option '-('
  Try 'zdb --help' for more information.
  ----------------------------------------
* DONE Database syntax -- only allow '\t' for indent
  CLOSED: [2026-01-24 Sat 12:36]
  The use of <space> for indentation makes almost all normal text files into
  valid ZDB files which makes far to easy to accidentally/unintentionally
  invoke zdb in a way which messes up some innocent text file.
* DONE Document file format in manpage
  CLOSED: [2026-01-26 Mon 09:20]
  Add a 'ZDB FILE FORMAT' section to the manpage, after the 'QUERIES' section.
* TODO Add query prefix '#' (comment matching)
* TODO Add query prefix '^' (case sensitivity)
  Also change --smart-match so that an upper case letter will affect the
  matching of that specific search term, but not the whole query.

  Currently the following command case-sensitively finds (only) {poq}. But it
  should find both {poq} AND {poQ} (the capital 'Q' should only cause the
  matching of 'QQ' itself to become case-sensitive).
  ----------------------------------------
  zdb 'QQ,{poq}' klingon.zdb
  ----------------------------------------
* TODO Support multiple queries (using -e)
  These should, just like for grep, be combined using OR.
* TODO `--show-query` -- to show cleaned up query (without searching)
  What would the option be called? `--show-query`?

  The normalized query should be shown. -- It is not totally obvious that this
  is the best version to show, since the normalized version might LONGER than
  what the user inputted (for example, `-=(a b c)` becomes `-=a, -=b, -=c`) --
  but having it spelled out like this makes it easier to reason about and debug
  the query. -- Which, I think would be one of the most useful aspects of a
  `--show-query` option.
* TODO Better dumping of blessed vars in debug()
  The debug() function should test if a package has dump() (or some other
  name?) function and then use that to stringify the a package variable, rather
  than have code to implement that itself.
* TODO Add database %opt for allowed field values
  (See: https://gnu.org/software/recutils/manual/recutils.html#Field-Types)
  TYPEDESC can be any of:
  ----------------------------------------
  + range [MIN] MAX
  + (int|real|bool)
  + size 25
  + regexp /REGEX/
  + enum NAME [NAME]...
  + (date|email|field|uuid)
  + rec RECORDSET
  ----------------------------------------
** TODO %typedef: TYPENAME (TYPENAME|TYPEDESC)
** TODO %type: FIELDNAME[,FIELDNAME]... (TYPENAME|TYPEDESC)
* TODO Add database %opt for allowed field names
  Are all of these really needed, or can %constraint be leveraged to cover for
  all of them, with a cleaner, easier-to-remember syntax?
  (See: https://gnu.org/software/recutils/manual/recutils.html#Constraints-on-Record-Sets)
** TODO %mandatory: FIELDNAME...
   Fields required in each record. (`%mandatory` may be used multiple times.)
** TODO %allowed: FIELDNAME...
   Fields allowed in each record. If used, only the fields specified by
   `%allowed`, `%mandatory` and `%key` may occur in a record. If unused, any
   non-prohibited field name may occur in a record. (`%allowed` may be used
   multiple times.)
** TODO %prohibit: FIELDNAME...
   Fields which may may not occur within any record. (`%prohibit` may be used
   multiple times.)
** TODO %unique: FIELDNAME...
   Fields which may (at most) occur only once within a single record.
   (`%unique` may be used multiple times.)
** TODO %key: FIELDNAME
   Specify the 'primary key' of a record set. The given field must occur
   exactly once in each record (as with `%unique` plus `$mandatory`), and the
   field value of must be unique across the record set (`%singular`). (`%key`
   may only be used once.)
** TODO %singular: FIELDNAME
   Field must have a unique value a cross the record set. (Rectools manual
   doesn't mention whether `%singular` can me used multiple times, but I don't
   see why not.)
** TODO %size: [OPERATOR] NUMBER
   Number of allowed records in record set. I<Operator> may be either of `<`,
   `<=`, `>` or `=>` (without I<operator> `=` is assumed).
** TODO %constraint: EXPRESSION
   Apply an arbitrary constraint to a record. (`%constraint` may be used
   multiple times.)
* TODO Change some terminology(?)
  + special field -> metadata field
  + (ordinary) field -> data field
  + field value -> field content
* TODO Two double quotes in a row should match «"»
  Regardless of whether or not this is used inside a double quoted string or
  not.
* TODO Space matching
  Maybe ditch «_» when matching spaces, and just make all space (even within
  quotes) match any sequence of whitespace (including newlines and indentation)
  and punctuation characters.

  This kinda make sense, as punctuation is usually irrelevant.
* Prefix support
  For ':' matches, reduce the inputted entry by removing non-matching fields,
  and replacing them with '[]' (so that the hilite marks are still valid).
* UNIT TESTS
** TODO Database field insert, non-matching query (should fail)
** TODO Database field insert, multiple-matching query (should fail)
** TODO Database field insert, single-matching query (should work)
** TODO Database record insert
* [eof]
